{% extends 'main/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- Employees Section -->
<section class="employees">
    <div class="employees__header">
        <h1 class="employees__title">
            {% trans "Співробітники" %}
            <span class="employees__count">({{ total_count }})</span>
        </h1>
        <div class="employees__controls">
            <!-- PDF Export -->
            <a href="{% url 'main:export_pdf' %}?{{ params }}"
               class="employees__pdf-btn"
               id="pdfExportBtn"
               title="{% trans 'Сформувати PDF' %}">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd"/>
                </svg>
                <span class="pdf-btn-text">{% trans "PDF" %}</span>
            </a>

            <!-- Filter Dropdown Button -->
            <button class="employees__filter"
                    hx-get="{% url 'main:dashboard' %}?action=filter"
                    hx-target="#filter-dropdown"
                    hx-swap="innerHTML"
                    aria-label="Filter">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z"/>
                </svg>
            </button>

            <!-- Add Employee Button -->
            <button class="employees__add-btn"
                    hx-get="{% url 'main:employee_form' %}?action=create"
                    hx-target="#modal-container"
                    hx-swap="innerHTML">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                </svg>
                {% trans "Додати робітника" %}
            </button>
        </div>
    </div>

    <!-- Pagination Top -->
    {% include 'main/partials/pagination.html' with position='top' %}

    <!-- Employees Table -->
    <div class="employees__table-wrapper">
        <div class="employees-table" id="employeesTable">
            <!-- Header -->
            <div class="employees-table__head">
                <div class="employees-table__row employees-table__row--header">
                    {% include 'main/partials/table_header.html' %}
                </div>
            </div>

            <!-- Body with HTMX -->
            <div class="employees-table__body"
                 id="employees-table-body"
                 hx-get="{% url 'main:dashboard' %}"
                 hx-trigger="employeeCreated from:body, employeeUpdated from:body, employeeDeleted from:body"
                 hx-target="this"
                 hx-swap="outerHTML"
                 hx-include="[name='ordering'], [name='status'], [name='q'], [name='page']">
                {% include 'main/partials/employees_table_body.html' %}
            </div>
        </div>
    </div>

    <!-- Pagination Bottom -->
    {% include 'main/partials/pagination.html' with position='bottom' %}
</section>

<!-- Modal Container for HTMX -->
<div id="modal-container"></div>

<!-- Filter Dropdown Container -->
<div id="filter-dropdown"></div>

<!-- HTMX Scripts -->
<script>
    // Handle modal close
    document.addEventListener('closeModal', function() {
        const modalContainer = document.getElementById('modal-container');
        if (modalContainer) {
            modalContainer.innerHTML = '';
        }
    });

    // Handle employee created/updated
    document.addEventListener('employeeCreated', function() {
        showNotification('Співробітника успішно додано');
    });

    document.addEventListener('employeeUpdated', function() {
        showNotification('Дані співробітника оновлено');
    });

    document.addEventListener('employeeDeleted', function() {
        showNotification('Співробітника видалено');
    });

    // Notification function
    function showNotification(message) {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #28A745;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 3000;
            animation: slideInRight 0.3s ease;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }
</script>
{% endblock %}